---
title: Authentication
excerpt: Using a custom authentication with DrupalClient.
---

<Callout icon="⚠️">

The `DrupalClient` is available in `next-drupal ^1.3.0` as **experimental**.

</Callout>

The `DrupalClient` works with several auth types. You can use **Bearer** (`client_credentials`), **Basic** or bring your own authorization headers.

Authentication can be set globally or per method.

## Global Auth

This is the default authentication configured on the client. This is used most of the time for fetching and building static pages.

```ts title=lib/drupal.ts
import { Experiment_DrupalClient as DrupalClient } from "next-drupal"

export const drupal = new Experiment_DrupalClient(
  process.env.NEXT_PUBLIC_DRUPAL_BASE_URL,
  {
    auth: // Configure the global auth here.
  }
)
```

## Method Auth

You can also set a custom auth per method call.

```ts
import { drupal } from "lib/drupal"

const userArticles = await drupal.getResourceCollection("node--article", {
  params: { //.... }
  withAuth: // Set the custom auth here.
})
```

---

## Bearer

To configure authentication, provide a `client_id` and `client_secret` as options.

<Callout icon="⚠️">

You need to enable the `simple_oauth` module on Drupal.

</Callout>

```ts title=lib/drupal.ts
import { Experiment_DrupalClient as DrupalClient } from "next-drupal"

export const drupal = new Experiment_DrupalClient(
  process.env.NEXT_PUBLIC_DRUPAL_BASE_URL,
  {
    auth: {
      clientId: process.env.DRUPAL_CLIENT_ID,
      clientSecret: process.env.DRUPAL_CLIENT_SECRET,
    },
  }
)
```

`DrupalClient` will fetch **Bearer** token and handle expiration for you.

If you need to customize the OAuth url you can use the `url` option.

```ts title=lib/drupal.ts
import { Experiment_DrupalClient as DrupalClient } from "next-drupal"

export const drupal = new DrupalClient(
  process.env.NEXT_PUBLIC_DRUPAL_BASE_URL,
  {
    auth: {
      clientId: process.env.DRUPAL_CLIENT_ID,
      clientSecret: process.env.DRUPAL_CLIENT_SECRET,
      url: `/oauth2/token`,
    },
  }
)
```

---

## Basic

You can also use the basic authorization header as follows:

<Callout icon="⚠️">

You need to enable the `basic_auth` module on Drupal.

</Callout>

```ts title=lib/drupal.ts
import { Experiment_DrupalClient as DrupalClient } from "next-drupal"

export const drupal = new DrupalClient(
  process.env.NEXT_PUBLIC_DRUPAL_BASE_URL,
  {
    auth: {
      username: process.env.DRUPAL_USERNAME,
      password: process.env.DRUPAL_PASSWORD,
    },
  }
)
```

---

## Callback

You can also provide a custom callback for authentication. The callback must return an `Authorization` compatible header.

```ts title=lib/drupal.ts
import { Experiment_DrupalClient as DrupalClient } from "next-drupal"

export const drupal = new DrupalClient(
  process.env.NEXT_PUBLIC_DRUPAL_BASE_URL,
  {
    auth: () => {
      // Do something and return an Authorization header.
    },
  }
)
```

## Access Token

You can also pass in an access token.

```ts
import { Experiment_DrupalClient as DrupalClient } from "next-drupal"

export const drupal = new DrupalClient(
  process.env.NEXT_PUBLIC_DRUPAL_BASE_URL,
  {
    auth: {
      access_token: "ECYM594IlARGc3S8KgBHvTpki0rDtWx6...",
      token_type: "bearer",
      expires_in: 3600,
    },
  }
)
```

## NextAuth

If you're using [NextAuth](https://next-auth.js.org) you can use the results from `getSession`:

```ts
import { Experiment_DrupalClient as DrupalClient } from "next-drupal"
import { getSession } from "next-auth/react"

export const drupal = new DrupalClient(
  process.env.NEXT_PUBLIC_DRUPAL_BASE_URL,
  {
    auth: session.accessToken,
  }
)
```
